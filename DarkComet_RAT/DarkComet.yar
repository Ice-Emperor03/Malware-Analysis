rule DARKCOMET_FEATURES{
    meta:
        description = "DarkComet" 
        author = "Ice Emperor"
        date = "2024-07-14"
        maltype = "Remote Access Trojan"
        filetype = "exe"
        
    strings:
        $bot1 = /(#)BOT#OpenUrl/  
        $bot2 = /(#)BOT#Ping/  
        $bot3 = /(#)BOT#RunPrompt/  
        $bot4 = /(#)BOT#SvrUninstall/  
        $bot5 = /(#)BOT#URLDownload/  
        $bot6 = /(#)BOT#URLUpdate/  
        $bot7 = /(#)BOT#VisitUrl/  
        $bot8 = /(#)BOT#CloseServer/  

        $ddos1 = /(D)DOSHTTPFLOOD/  
        $ddos2 = /(D)DOSSYNFLOOD/  
        $ddos3 = /(D)DOSUDPFLOOD/  

        $keylogger1 = /(A)ctiveOnlineKeylogger/  
        $keylogger2 = /(U)nActiveOnlineKeylogger/  
        $keylogger3 = /(A)ctiveOfflineKeylogger/  
        $keylogger4 = /(U)nActiveOfflineKeylogger/  

        $shell1 = /(A)CTIVEREMOTESHELL/  
        $shell2 = /(S)UBMREMOTESHELL/  
        $shell3 = /(K)ILLREMOTESHELL/  

    condition:
        4 of ($bot*) or all of ($ddos*) or all of ($keylogger*) or all of ($shell*)
}
rule DARKCOMET_STRINGS{
    meta:
        description = "DarkComet" 
        author = "Ice Emperor"
        date = "2024-07-14"
        maltype = "Remote Access Trojan"
        filetype = "exe"

    strings:
        $string1 = "Command successfully executed!"
        $string2 = "NETDATA" nocase
        $string3 = "%s, ClassID: %s"
        $string4 = "I wasn't able to open the hosts file"
        $string5 = "#KCMDDC"
        $string6 = "FastMM Borland Edition"
        $a1 = "WEBCAMSTOP"
        $a2 = "UnActiveOnlineKeyStrokes"
        $a3 = "#SendTaskMgr"
        $a4 = "#RemoteScreenSize"
        $a5 = "ping 127.0.0.1 -n 4 > NUL &&"
    condition:
        any of ($string*) and all of ($a*)
}
rule DARKCOMET_MUTEX {
    meta:
        description = "DarkComet"
        author = "Ice Emperor"
        date = "2024-07-14"
        maltype = "Remote Access Trojan"
        filetype = "exe"
       /*
        Dark Comet has a default MUTEX of DC_MUTEX-7 random Alphanumeric characters
        I added a wildcard to detect variants in case it changes
      */
    strings:
        $MUTEX_original = /DC_MUTEX-[0-9A-Z]{7}/
        $MUTEX_variant = /DC_MUTEX-\w*/
    
    condition:
        $MUTEX_original or $MUTEX_variant
}
rule DARKCOMET_DIRECTORY{
    meta:
        description = "DarkComet"
        author = "Ice Emperor"
        date = "2024-07-14"
    strings:
      /*
        Dark Comet creates the MSDCSC directory, which is a common path utilized by it.
        The hex when translated to text: MSDCSC\xxxx.exe, I replaced xxxx with a YARA 
        wildard just in case the name of the executable changes. (Deafult: msdcsc.exe) 
      */
        $hex1 = {4D 53 44 43 53 43 5C [-] 2E 65 78 65}
    condition:
        $hex1
}
